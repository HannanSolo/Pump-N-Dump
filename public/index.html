<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pump N Dump!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="js/Chart.js"></script>
</head>
<body>
        
<!-- Page Container -->
<div id="page-container">
    <!-- Pump Buttons -->
    <div id="pump-container">
        <div id="coins-container">

        </div>
    </div>

    <!-- Dump Button -->
    <div id="dump-container">
        <div id="dump-card" class="coins">
            <p class="button-text">Bitcoin</p>
            <p class="button-text">How much do you want to pump?</p>
            <input id="pump-amount" type="text"><br/>
            <button onclick="pump()">PUMP!</button>
        </div>
    </div>
</div>

<!-- Electron Render -->
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
//allow server&client to talk
const {ipcRenderer} = require('electron');
//ask for api data
ipcRenderer.send('readyForData', '');
//on obtained api data
var initialData = true;
ipcRenderer.on('apiData', (event, data) => {
    //if first request
    //if(initialData){
        populatePage(data);
        initialData = false;
    //}
    //ask for more data every 2 seconds
    setTimeout(function(){
        ipcRenderer.send('readyForData', '');
    },5000);
});


//////////////////////////
// Functions
//////////////////////////
function populatePage(data){
    //add coin cards to html
    var holder = document.getElementById('coins-container');
    //create coin cards
    for(var coin in data.balances){
        //ignore bitcoin
        if(coin !== 'BTC')
            createCoinCard(coin);
    }
    //load graphs after coin cards
    for(var coin in data.balances){
        //ignore bitcoin
        if(coin !== 'BTC')
            createChart(coin);
    }
}

//create cards for other coins
function createCoinCard(coinName){
    //skip if coin card already exsits
    if(document.getElementById(coinName.toLowerCase()))
        return;
    //add coin card
    var holder = document.getElementById('coins-container');
    holder.innerHTML +=
        '<div id='+coinName.toLowerCase()+' class="coins">'
            +'<p class="button-text">'+coinName+'</p>'
            +'<p class="button-text"><canvas width="219" height="219"></canvas></p>'
            +'<div class="slidecontainer">'
                +'<input type="range" min="1" max="100" value="50" class="slider" id="myRange">'
            +'</div>'
        +'</div>';
}
//create bitcoin card
function createBitCoinCard(coinName){
    //skip if coin card already exsits
    if(document.getElementById(coinName.toLowerCase()))
        return;
    //add coin card
    var holder = document.getElementById('dump-container');
    holder.innerHTML +=
        '<div id='+coinName.toLowerCase()+' class="coins">'
            +'<p class="button-text">'+coinName+'</p>'
            +'<p class="button-text"><canvas width="219" height="219"></canvas></p>'
            +'<div class="slidecontainer">'
                +'<input type="range" min="1" max="100" value="50" class="slider" id="myRange">'
            +'</div>'
        +'</div>';
}
//create coin card chart
function createChart(coinName){
    var ctx = document.querySelector('#'+coinName.toLowerCase()+' canvas');
    //var ctx = document.getElementById('bbc');
    Chart.defaults.line.spanGaps = true;
    var coinChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [0,12,24],
            datasets: [{ 
                data: [0,0,0],
                borderColor: "#3e95cd",
                fill: false
            }
            ]
        },
        options: {
            title: {
            display: true,
            text: '24H'
            }
        }
    });
}

</script>
</body>
</html>
