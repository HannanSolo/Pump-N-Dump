<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pump N Dump!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="js/Chart.js"></script>
</head>
<body>
        
<!-- Page Container -->
<div id="page-container">
    <div id="addCoin" style="font-size:64px;display:inline-flex;align-items:center;justify-items:center;">
        <button onclick="addCoinCard()" style="width:225px; height:50px; background-color:blue;border:0px"> + </button>
    </div>
    <!-- Pump Buttons -->
    <div id="pump-container">
        <div id="coins-container">
        </div>
    </div>

    <!-- Dump Button -->
    <div id="dump-container">
        <div id="dump-card" class="coins">
            <p class="button-text">Bitcoin</p>
            <p class="button-text">How much do you want to pump?</p>
            <input id="pump-amount" type="text"><br/>
            <button onclick="pump()">PUMP!</button>
        </div>
    </div>
</div>

<!-- Electron Render -->

<script>
var apiData = {}
const prompt = require('electron-prompt');
//allow server&client to talk
const {ipcRenderer} = require('electron');
//ask for api data
ipcRenderer.send('readyForData', '');
//on obtained api data
var initialData = true;
ipcRenderer.on('apiData', (event, data) => {
    apiData.prices = data.prices;
    apiData.balances = data.balances;
    //if first request
    //if(initialData){
        populatePage(data);
        initialData = false;
    //}
    //ask for more data every 2 seconds
    setTimeout(function(){
        ipcRenderer.send('readyForData', '');
    },5000);
});
setTimeout(function() {
    ipcRenderer.send('readyForGraph', '')
}, 5000);
ipcRenderer.on('graphData', (event, arg) => {
    apiData.ltc = arg;
    console.log(apiData.balances);
    console.log(apiData.ltc);
})

setInterval(function(){
    if(apiData !== {}){
        //...update price
    }
},3000)

//////////////////////////
// Functions
//////////////////////////
function populatePage(data){
    //add coin cards to html
    var holder = document.getElementById('coins-container');
    //create coin cards
    for(var coin in data.balances){
        //ignore bitcoin
        if(coin !== 'BTC')
            createCoinCard(coin);
    }
    
    //load graphs after coin cards
    for(var coin in data.balances){
        //ignore bitcoin
        if(coin !== 'BTC')
            if (apiData.ltc != {}) {
                createChart(coin, apiData.ltc);
            }  
    }
}

//create cards for other coins
function createCoinCard(coinName){
    //skip if coin card already exsits
    if(document.getElementById(coinName.toLowerCase()))
        return;
    //add coin card
    var holder = document.getElementById('coins-container');
    holder.innerHTML +=
        '<div id='+coinName.toLowerCase()+' class="coins">'
            +'<p class="button-text">'+coinName+'</p>'
            +'<p class="button-text"><canvas width="219" height="219"></canvas></p>'
            +'<div class="slidecontainer">'
                +'<input type="range" min="1" max="100" value="50" class="slider" id="myRange">'
            +'</div>'
        +'</div>';
}
//create bitcoin card
function createBitCoinCard(coinName){
    //skip if coin card already exsits
    if(document.getElementById(coinName.toLowerCase()))
        return;
    //add coin card
    var holder = document.getElementById('dump-container');
    holder.innerHTML +=
        '<div id='+coinName.toLowerCase()+' class="coins">'
            +'<p class="button-text">'+coinName+'</p>'
            +'<p class="button-text"><canvas width="219" height="219"></canvas></p>'
            +'<div class="slidecontainer">'
                +'<input type="range" min="1" max="100" value="50" class="slider" id="myRange">'
            +'</div>'
        +'</div>';
}

function addCoinCard() {
    console.log("called")
    prompt({
        title: 'Select A Coin',
        label: 'Select A Coin:',
        value: 'http://example.org',
        inputAttrs: { // attrs to be set if using 'input'
            type: 'url'
        },
        type: 'select', // 'select' or 'input, defaults to 'input'
        selectOptions: { // select options if using 'select' type
            'ETH': 'ETH' + " " + "0.1 BTC",
            'value 2': 'Display Option 2',
            'value 3': 'Display Option 3'
        }
    })
    .then((r) => {
        console.log('result', r); // null if window was closed, or user clicked Cancel
    })
    .catch(console.error);
    }
//create coin card chart
function createChart(coinName, gdata){
    var ctx = document.querySelector('#'+coinName.toLowerCase()+' canvas');
    //var ctx = document.getElementById('bbc');
    Chart.defaults.line.spanGaps = true;
    var coinChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],
            datasets: [{ 
                data: gdata,
                borderColor: "#3e95cd",
                fill: false
            }
            ]
        },
        options: {
            title: {
            display: true,
            text: '24H'
            }
        }
    });
}

</script>
</body>
</html>
